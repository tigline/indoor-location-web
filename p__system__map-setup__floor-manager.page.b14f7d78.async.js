"use strict";(self.webpackChunkheyanai_navigation=self.webpackChunkheyanai_navigation||[]).push([[114],{51042:function(Y,O,e){var _=e(1413),g=e(67294),h=e(42110),E=e(98615),y=function(v,f){return g.createElement(E.Z,(0,_.Z)((0,_.Z)({},v),{},{ref:f,icon:h.Z}))};y.displayName="PlusOutlined",O.Z=g.forwardRef(y)},31199:function(Y,O,e){var _=e(1413),g=e(91),h=e(67294),E=e(86682),y=e(85893),s=["fieldProps","min","proFieldProps","max"],v=function(o,D){var R=o.fieldProps,j=o.min,L=o.proFieldProps,F=o.max,C=(0,g.Z)(o,s);return(0,y.jsx)(E.Z,(0,_.Z)({valueType:"digit",fieldProps:(0,_.Z)({min:j,max:F},R),ref:D,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:L},C))},f=h.forwardRef(v);O.Z=f},88923:function(Y,O,e){e.d(O,{h:function(){return F}});var _=e(97857),g=e.n(_),h=e(15009),E=e.n(h),y=e(99289),s=e.n(y),v=e(59061),f=e(35312),A=e(69400),o=e(90156),D=e(96486),R=e.n(D),j=e(491),L=e(85893);function F(C){var S=(0,f.useIntl)();return(0,L.jsx)(v.Z,g()(g()({accept:"image/png",max:1,transform:function(a){var Z,b,U={};return(0,D.set)(U,(Z=C.name)!==null&&Z!==void 0?Z:"picture",(b=(0,D.first)(a))===null||b===void 0?void 0:b.response),U}},C),{},{fieldProps:{listType:"picture-card",onPreview:function(a){A.Z.warning({content:(0,L.jsx)(o.Z,{width:600,src:a.thumbUrl}),width:660-12,icon:" "})},customRequest:function(){var B=s()(E()().mark(function Z(b){var U,K,$,z;return E()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return U=b.file,K=new FormData,K.append("file",U),M.prev=3,M.next=6,(0,j.cT)(K);case 6:z=M.sent,console.log(z),($=b.onSuccess)===null||$===void 0||$.call(b,z.data.url),M.next=14;break;case 11:M.prev=11,M.t0=M.catch(3),console.log(M.t0);case 14:case"end":return M.stop()}},Z,null,[[3,11]])}));function a(Z){return B.apply(this,arguments)}return a}()}}))}},89512:function(Y,O,e){e.d(O,{v:function(){return y}});var _=e(35312),g=e(86738),h=e(71577),E=e(85893);function y(s){var v,f,A,o,D=(0,_.useIntl)();return(0,E.jsx)(g.Z,{title:(v=s.title)!==null&&v!==void 0?v:D.formatMessage({id:"app.remove.confirm.title",defaultMessage:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u6B64\u9879\u5417?"}),description:(f=s.title)!==null&&f!==void 0?f:D.formatMessage({id:"app.remove.confirm.description",defaultMessage:"\u5220\u9664\u6B64\u9879"}),okButtonProps:{loading:s.loading},getPopupContainer:s.getPopupContainer,onConfirm:function(){var j;return s==null||(j=s.onClick)===null||j===void 0?void 0:j.call(s)},children:!s.children&&(0,E.jsx)(h.ZP,{type:(A=s.type)!==null&&A!==void 0?A:"link",size:(o=s.size)!==null&&o!==void 0?o:"small",disabled:s.disabled,children:(0,E.jsx)(_.FormattedMessage,{id:"app.remove",defaultMessage:"\u5220\u9664"})})})}},69688:function(Y,O,e){e.r(O),e.d(O,{default:function(){return q}});var _=e(89512),g=e(491),h=e(69851),E=e(90930),y=e(9455),s=e(35312),v=e(54689),f=e(71577),A=e(97857),o=e.n(A),D=e(5574),R=e.n(D),j=e(88923),L=e(51042),F=e(37476),C=e(5966),S=e(31199),B=e(12029),a=e(85893);function Z(r){var t=(0,s.useIntl)(),d=r.buildingId,n=B.Z.useForm(),p=R()(n,1),l=p[0],x=(0,s.useModel)("mapModel"),P=x.run;return(0,a.jsxs)(F.Y,{title:(0,a.jsx)(s.FormattedMessage,{id:"pages.system.map-setup.map.add",defaultMessage:"\u6DFB\u52A0\u5730\u56FE"}),layout:"horizontal",form:l,labelCol:{xs:6},wrapperCol:{xs:16},disabled:!d,modalProps:{destroyOnClose:!0,onCancel:function(){return console.log("run")}},onFinish:function(m){return(0,g.JY)(o()(o()({},m),{},{buildingId:d})).then(function(c){var u;return(u=r.refresh)===null||u===void 0||u.call(r),P(!0),v.Z.success({message:t.formatMessage({id:"app.add.success",defaultMessage:"\u65B0\u5EFA\u6210\u529F"})}),c.code===h.OK})},trigger:(0,a.jsxs)(f.ZP,{type:"primary",children:[(0,a.jsx)(L.Z,{}),t.formatMessage({id:"app.add",defaultMessage:"\u65B0\u5EFA"})]}),children:[(0,a.jsx)(C.Z,{width:"lg",name:"name",label:t.formatMessage({id:"pages.system.map-setup.map.name",defaultMessage:"\u5730\u56FE\u540D\u79F0"}),rules:[{required:!0,message:t.formatMessage({id:"pages.system.map-setup.map.name.required.failure",defaultMessage:"\u5EFA\u7B51\u540D\u5FC5\u586B"})}]}),(0,a.jsx)(C.Z,{width:"lg",name:"floor",label:t.formatMessage({id:"pages.system.map-setup.map.floor",defaultMessage:"\u697C\u5C42"}),rules:[{required:!0,message:t.formatMessage({id:"pages.system.map-setup.map.floor.required.failure",defaultMessage:"\u697C\u5C42\u5FC5\u586B"})}]}),(0,a.jsx)(S.Z,{width:"lg",name:"width",label:t.formatMessage({id:"pages.system.map-setup.map.width",defaultMessage:"\u5B9E\u9645\u5BBD\u5EA6"}),addonAfter:t.formatMessage({id:"app.unit.m",defaultMessage:"\u7C73"}),rules:[{required:!0,message:t.formatMessage({id:"pages.system.map-setup.map.width.required.failure",defaultMessage:"\u5B9E\u9645\u5BBD\u5EA6\u5FC5\u586B"})}]}),(0,a.jsx)(S.Z,{width:"lg",name:"length",addonAfter:t.formatMessage({id:"app.unit.m",defaultMessage:"\u7C73"}),label:t.formatMessage({id:"pages.system.map-setup.map.length",defaultMessage:"\u5B9E\u9645\u957F\u5EA6"}),rules:[{required:!0,message:t.formatMessage({id:"pages.system.map-setup.map.length.required.failure",defaultMessage:"\u5B9E\u9645\u957F\u5EA6\u5FC5\u586B"})}]}),(0,a.jsx)(j.h,{width:"lg",name:"picture",label:t.formatMessage({id:"pages.system.map-setup.building.picture",defaultMessage:"\u793A\u610F\u56FE"}),rules:[{required:!0,message:t.formatMessage({id:"pages.system.map-setup.building.address.required.failure",defaultMessage:"\u793A\u610F\u56FE\u5FC5\u586B"})}]})]})}function b(r){var t,d,n=(0,s.useIntl)(),p=r.record,l=p.buildingId,x=p.mapId,P=B.Z.useForm(),i=R()(P,1),m=i[0],c=(0,s.useModel)("mapModel"),u=c.run;return(0,a.jsxs)(F.Y,{title:(0,a.jsx)(s.FormattedMessage,{id:"pages.system.map-setup.map.edit",defaultMessage:"\u6DFB\u52A0\u5730\u56FE"}),layout:"horizontal",form:m,labelCol:{xs:6},wrapperCol:{xs:16},disabled:!l,modalProps:{destroyOnClose:!0,onCancel:function(){return console.log("run")}},onFinish:function(V){return(0,g.sA)({mapId:x},o()(o()({},V),{},{buildingId:l})).then(function(W){if(W.code===h.OK){var w;(w=r.refresh)===null||w===void 0||w.call(r),u(!0),v.Z.success({message:n.formatMessage({id:"app.edit.success",defaultMessage:"\u66F4\u65B0\u6210\u529F"})})}return W.code===h.OK})},trigger:(0,a.jsx)(f.ZP,{type:"link",size:"small",children:n.formatMessage({id:"app.edit",defaultMessage:"\u7F16\u8F91"})}),children:[(0,a.jsx)(C.Z,{width:"lg",name:"name",initialValue:r.record.name,label:n.formatMessage({id:"pages.system.map-setup.map.name",defaultMessage:"\u5730\u56FE\u540D\u79F0"}),rules:[{required:!0,message:n.formatMessage({id:"pages.system.map-setup.map.name.required.failure",defaultMessage:"\u5730\u56FE\u540D\u5FC5\u586B"})}]}),(0,a.jsx)(C.Z,{width:"lg",name:"floor",initialValue:r.record.floor,label:n.formatMessage({id:"pages.system.map-setup.map.floor",defaultMessage:"\u697C\u5C42"}),rules:[{required:!0,message:n.formatMessage({id:"pages.system.map-setup.map.floor.required.failure",defaultMessage:"\u697C\u5C42\u5FC5\u586B"})}]}),(0,a.jsx)(S.Z,{width:"lg",name:"width",initialValue:r.record.width,label:n.formatMessage({id:"pages.system.map-setup.map.width",defaultMessage:"\u5B9E\u9645\u5BBD\u5EA6"}),addonAfter:n.formatMessage({id:"app.unit.m",defaultMessage:"\u7C73"}),rules:[{required:!0,message:n.formatMessage({id:"pages.system.map-setup.map.width.required.failure",defaultMessage:"\u5B9E\u9645\u5BBD\u5EA6\u5FC5\u586B"})}]}),(0,a.jsx)(S.Z,{width:"lg",name:"length",initialValue:r.record.length,label:n.formatMessage({id:"pages.system.map-setup.map.length",defaultMessage:"\u5B9E\u9645\u957F\u5EA6"}),addonAfter:n.formatMessage({id:"app.unit.m",defaultMessage:"\u7C73"}),rules:[{required:!0,message:n.formatMessage({id:"pages.system.map-setup.map.length.required.failure",defaultMessage:"\u5B9E\u9645\u957F\u5EA6\u5FC5\u586B"})}]}),(0,a.jsx)(j.h,{width:"lg",name:"picture",initialValue:[{uid:Date.now()+"",response:(t=r.record)===null||t===void 0?void 0:t.picture,thumbUrl:(d=r.record)===null||d===void 0?void 0:d.picture}],label:n.formatMessage({id:"pages.system.map-setup.building.picture",defaultMessage:"\u793A\u610F\u56FE"}),rules:[{required:!0,message:n.formatMessage({id:"pages.system.map-setup.building.picture.required.failure",defaultMessage:"\u793A\u610F\u56FE\u5FC5\u586B"})}]})]})}var U=e(19632),K=e.n(U),$=e(87888),z=e(32240),J=e(45968),M=e(30692),G=e(62466),N=e(4393),T=e(67294),H=e(67058);function Q(r){var t,d=R()(r.rect,2),n=d[0],p=d[1],l=T.useState(),x=R()(l,2),P=x[0],i=x[1],m=T.useRef(null),c=T.useRef(),u=T.useRef();return T.useEffect(function(){var I;c.current=new G.Scene({id:m.current,map:new G.Mapbox({style:"blank",center:[0,0],pitch:0,zoom:20,minZoom:18})}),c.current.addImage("stationIcon",J.Z),c.current.addImage("arrow",$.Z),c.current.addImage("personImage",z.Z),c.current.addImage("warning",M.Z),(I=c.current)===null||I===void 0||I.on("loaded",function(){return i(!0)})},[]),T.useEffect(function(){if(r.map&&P&&p&&n){var I=(0,G.metersToLngLat)([n*H.bA,p*H.bA]);if(u.current)u.current.setData(r.map,{parser:{type:"image",extent:[0,0].concat(K()(I))}}),u.current.setIndex(0);else{var V,W;u.current=new G.ImageLayer({zIndex:0}),u.current.source(r.map,{parser:{type:"image",extent:[0,0].concat(K()(I))}}),(V=c.current)===null||V===void 0||V.setCenter([I[0]/2,I[1]/2]),(W=c.current)===null||W===void 0||W.addLayer(u.current)}}},[r.map,P,p,n]),(0,a.jsx)(T.Fragment,{children:(0,a.jsx)(N.Z,{bodyStyle:{padding:0},children:(0,a.jsx)("div",{id:"map",ref:m,style:{minHeight:(t=r.height)!==null&&t!==void 0?t:600}})})})}function X(r){var t=(0,s.useIntl)(),d=(0,s.useModel)("mapModel"),n=d.run,p=d.data;T.useEffect(function(){n()},[]);var l=p==null?void 0:p.find(function(x){return x.mapId===r.record.mapId});return(0,a.jsx)(F.Y,{title:t.formatMessage({id:"pages.system.map-setup.map.view",defaultMessage:"\u67E5\u770B\u5730\u56FE"}),submitter:!1,trigger:(0,a.jsx)(f.ZP,{type:"link",size:"small",children:(0,a.jsx)(s.FormattedMessage,{id:"app.view",defaultMessage:"\u9884\u89C8"})}),children:(0,a.jsx)(Q,{map:l==null?void 0:l.picture,rect:[l==null?void 0:l.length,l==null?void 0:l.width]})})}function q(){var r=(0,s.useMatch)("/system/map-setup/floor-manager.page/:buildingId"),t=r==null?void 0:r.params.buildingId,d=(0,s.useIntl)(),n=(0,s.useRequest)(g.yJ,{manual:!0,fetchKey:function(i){return i.mapId},onSuccess:function(i){i&&v.Z.success({message:d.formatMessage({id:"app.remove.success",defaultMessage:"\u5220\u9664\u6210\u529F"})})}}),p=n.run,l=n.loading,x=[{title:d.formatMessage({id:"pages.system.map-setup.map.name",defaultMessage:"\u5730\u56FE\u540D\u79F0"}),dataIndex:"name"},{title:d.formatMessage({id:"pages.system.map-setup.map.floor",defaultMessage:"\u697C\u5C42"}),dataIndex:"floor"},{title:d.formatMessage({id:"pages.system.map-setup.map.id",defaultMessage:"\u552F\u4E00\u6807\u8BC6"}),search:!1,dataIndex:"mapId"},{title:d.formatMessage({id:"app.action",defaultMessage:"\u64CD\u4F5C"}),valueType:"option",key:"option",render:function(i,m,c,u){return(0,a.jsxs)(f.ZP.Group,{children:[(0,a.jsx)(b,{disabled:!m.mapId,record:m}),(0,a.jsx)(X,{record:m}),(0,a.jsx)(_.v,{disabled:!m.mapId,loading:l,onClick:function(){return p({mapId:m.mapId}).then(function(){u==null||u.reload()})}})]})}}];return(0,a.jsx)(E._z,{children:(0,a.jsx)(y.Z,{options:{setting:!1},pagination:!1,columns:x,toolBarRender:function(i){return[(0,a.jsx)(Z,{buildingId:t,refresh:i==null?void 0:i.reload},"add")]},request:function(i){return(0,g.pl)({buildingId:t,name:i.name}).then(function(m){return{data:m.data,success:m.code===h.OK}})}})})}}}]);

"use strict";(self.webpackChunkheyanai_navigation=self.webpackChunkheyanai_navigation||[]).push([[478],{78844:function(ee,W,e){var g=e(1413),_=e(91),A=e(86190),r=e(67294),S=e(66758),s=e(86682),R=e(85893),m=["fieldProps","proFieldProps"],l="dateTimeRange",U=r.forwardRef(function(E,M){var w=E.fieldProps,D=E.proFieldProps,t=(0,_.Z)(E,m),P=(0,r.useContext)(S.Z);return(0,R.jsx)(s.Z,(0,g.Z)({ref:M,fieldProps:(0,g.Z)({getPopupContainer:P.getPopupContainer},w),valueType:l,proFieldProps:D,filedConfig:{valueType:l,customLightMode:!0,lightFilterLabelFormatter:function(B){return(0,A.c)(B,"YYYY-MM-DD HH:mm:ss")}}},t))});W.Z=U},64317:function(ee,W,e){var g=e(1413),_=e(91),A=e(22270),r=e(67294),S=e(66758),s=e(86682),R=e(85893),m=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],l=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],U=r.forwardRef(function(t,P){var i=t.fieldProps,B=t.children,j=t.params,T=t.proFieldProps,y=t.mode,K=t.valueEnum,b=t.request,$=t.showSearch,z=t.options,L=(0,_.Z)(t,m),x=(0,r.useContext)(S.Z);return(0,R.jsx)(s.Z,(0,g.Z)((0,g.Z)({valueEnum:(0,A.h)(K),request:b,params:j,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,g.Z)({options:z,mode:y,showSearch:$,getPopupContainer:x.getPopupContainer},i),ref:P,proFieldProps:T},L),{},{children:B}))}),E=r.forwardRef(function(t,P){var i=t.fieldProps,B=t.children,j=t.params,T=t.proFieldProps,y=t.mode,K=t.valueEnum,b=t.request,$=t.options,z=(0,_.Z)(t,l),L=(0,g.Z)({options:$,mode:y||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label"},i),x=(0,r.useContext)(S.Z);return(0,R.jsx)(s.Z,(0,g.Z)((0,g.Z)({valueEnum:(0,A.h)(K),request:b,params:j,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,g.Z)({getPopupContainer:x.getPopupContainer},L),ref:P,proFieldProps:T},z),{},{children:B}))}),M=U,w=E,D=M;D.SearchSelect=w,D.displayName="ProFormComponent",W.Z=D},23809:function(ee,W,e){e.d(W,{$:function(){return R}});var g=e(97857),_=e.n(g),A=e(64317),r=e(48141),S=e(67294),s=e(85893);function R(m){var l,U=(0,r.useIntl)(),E=(0,r.useModel)("mapModel"),M=E.run,w=E.options,D=E.loading,t=E.initialValue;return S.useEffect(function(){M()},[]),(0,s.jsx)(A.Z,_()(_()({},m),{},{rules:[{required:!0,message:U.formatMessage({id:"pages.device-manage.track.map.required",defaultMessage:"\u8BF7\u9009\u62E9\u5730\u56FE"})}],width:"lg",name:"mapId",style:{width:240},fieldProps:{loading:D},initialValue:(l=m.initialValue)!==null&&l!==void 0?l:t,options:w}))}},75888:function(ee,W,e){e.d(W,{Z:function(){return M},l:function(){return w}});var g=e(15009),_=e.n(g),A=e(99289),r=e.n(A),S=e(97857),s=e.n(S),R=e(84140),m=e(69851),l=e(64317),U=e(48141),E=e(85893);function M(D){var t=(0,U.useIntl)(),P=(0,U.useRequest)(R.TB,{manual:!0,formatResult:function(j){var T,y,K=(T=(y=j.data)===null||y===void 0?void 0:y.map(function(b){return{label:b.deviceId,value:b.deviceId,key:b.deviceId}}))!==null&&T!==void 0?T:[];return K}}),i=P.run;return(0,E.jsx)(l.Z,s()({label:t.formatMessage({id:"pages.personnel-manage.organization.department.person.tag",defaultMessage:"\u7ED1\u5B9A\u6807\u7B7E"}),request:function(){return i({})}},D))}function w(D){var t=(0,U.useIntl)();return(0,E.jsx)(l.Z,s()({request:function(){var P=r()(_()().mark(function i(B){var j,T,y,K,b,$;return _()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return y=B.keyWords,K=y===void 0?"":y,L.next=3,(0,R.$h)({current:"1",size:"20",name:K});case 3:return b=L.sent,$=(j=(T=(0,m.LF)(b).data)===null||T===void 0?void 0:T.map(function(x){return{label:x.name,value:x.deviceId,key:x.deviceId}}))!==null&&j!==void 0?j:[],L.abrupt("return",$);case 6:case"end":return L.stop()}},i)}));return function(i){return P.apply(this,arguments)}}(),placeholder:t.formatMessage({id:"pages.personnel-manage.organization.department.person.tag.placeholder",defaultMessage:"\u8BF7\u9009\u62E9\u6807\u7B7E"}),rules:[{required:!0,message:t.formatMessage({id:"pages.device-manage.track.beacon.required",defaultMessage:"\u8BF7\u9009\u62E9\u6807\u7B7E"})}],fieldProps:{showSearch:!0,style:{minWidth:180}}},D))}},76403:function(ee,W,e){e.r(W),e.d(W,{default:function(){return ne}});var g=e(5574),_=e.n(g),A=e(97857),r=e.n(A),S=e(19632),s=e.n(S),R=e(87888),m=e(32240),l=e(45968),U=e(30692),E=e(92138),M=e(62466),w=e(4393),D=e(96486),t=e(67294),P=e(67058),i=e(85893);function B(f){var F,H=_()(f.rect,2),V=H[0],C=H[1],N=t.useState(),o=_()(N,2),n=o[0],u=o[1],p=t.useRef(null),a=t.useRef(),O=t.useRef(),h=t.useRef(),v=t.useRef(),Y=t.useRef();return t.useEffect(function(){var c;a.current=new M.Scene({id:p.current,logoVisible:!1,map:new M.Mapbox({style:"blank",center:[0,0],pitch:0,zoom:20,minZoom:18})}),a.current.addImage("stationIcon",l.Z),a.current.addImage("arrow",R.Z),a.current.addImage("personImage",m.Z),a.current.addImage("warning",U.Z),(c=a.current)===null||c===void 0||c.on("loaded",function(){return u(!0)})},[]),t.useEffect(function(){if(f.map&&n&&C&&V){var c=(0,M.metersToLngLat)([V*P.bA,C*P.bA]);if(O.current)O.current.setData(f.map,{parser:{type:"image",extent:[0,0].concat(s()(c))}}),O.current.setIndex(0);else{var d,I;O.current=new M.ImageLayer({zIndex:0}),O.current.source(f.map,{parser:{type:"image",extent:[0,0].concat(s()(c))}}),(d=a.current)===null||d===void 0||d.setCenter([c[0]/2,c[1]/2]),(I=a.current)===null||I===void 0||I.addLayer(O.current)}}},[f.map,n,C,V]),t.useEffect(function(){if(n&&C&&!(0,D.isEmpty)(f.stations)){var c,d,I=(c=(d=f.stations)!==null&&d!==void 0?d:[])===null||c===void 0?void 0:c.map(function(Z){var Q=(0,P.qS)([Z.setX,Z.setY],C),X=_()(Q,2),k=X[0],J=X[1];return r()(r()({},Z),{},{lng:k,lat:J})});if(h.current)h.current.setData(I),h.current.setIndex(3);else{var G;h.current=new M.PointLayer({zIndex:3}).source(I,{parser:{type:"json",x:"lng",y:"lat",name:"name"}}).shape("name",["stationIcon"]).size(10),(G=a.current)===null||G===void 0||G.addLayer(h.current)}}},[f.stations,n,C]),t.useEffect(function(){if(n&&C){for(var c,d=(c=f.beacons)!==null&&c!==void 0?c:[],I=d==null?void 0:d.map(function(se){var pe=(0,P.qS)([se.posX,se.posY],C),le=_()(pe,2),ve=le[0],fe=le[1];return r()(r()({},se),{},{lng:ve,lat:fe})}),G=[],Z=0;Z<d.length;Z++){var Q=d[Z],X=d[Z+1];if(X){var k=(0,P.qS)([Q.posX,Q.posY],C),J=_()(k,2),ie=J[0],de=J[1],_e=(0,P.qS)([X.posX,X.posY],C),ue=_()(_e,2),me=ue[0],ce=ue[1];G.push(r()(r()({},Q),{},{lng:ie,lat:de,lng1:me,lat1:ce}))}}if(v.current)(0,D.isEmpty)(f.beacons)?v.current.hide():(v.current.show(),v.current.setData(G),v.current.setIndex(3));else{var re;v.current=new M.LineLayer({zIndex:3}).source(G,{parser:{type:"json",x:"lng",y:"lat",x1:"lng1",y1:"lat1"}}).shape("line").size(2).color(E.ek[3]).animate({interval:.4,duration:1,trailLength:.8}).style({lineTexture:!0,iconStep:20}),(re=a.current)===null||re===void 0||re.addLayer(v.current)}if(Y.current)(0,D.isEmpty)(f.beacons)?Y.current.hide():(Y.current.show(),Y.current.setData(I),Y.current.setIndex(4));else{var oe;Y.current=new M.PointLayer({zIndex:4}).source(I,{parser:{type:"json",x:"lng",y:"lat",name:"name"}}).shape("circle").color(E.ek[3]).size(5),(oe=a.current)===null||oe===void 0||oe.addLayer(Y.current)}}},[f.beacons,n,C]),(0,i.jsx)(t.Fragment,{children:(0,i.jsx)(w.Z,{bodyStyle:{padding:0},children:(0,i.jsx)("div",{id:"map",ref:p,style:{minHeight:(F=f.height)!==null&&F!==void 0?F:600}})})})}var j=e(23809),T=e(75888),y=e(84140),K=e(491),b=e(69851),$=e(90930),z=e(28199),L=e(57470),x=e(78844),q=e(48141),ae=e(27484),te=e.n(ae);function ne(){var f,F,H,V=(0,q.useIntl)(),C=t.useRef(),N=(0,q.useRequest)(K.FU,{manual:!0,formatResult:function(d){return d}}),o=N.run,n=N.data,u=(0,q.useRequest)(y.uz,{manual:!0}),p=u.run,a=u.data,O=(0,q.useRequest)(y.s_,{manual:!0,formatResult:function(d){return d}}),h=O.run,v=O.data;function Y(c){var d=c.mapId;return o({mapId:d}).then(function(){return p({mapId:d})}).then(function(){return h(c)}).then(function(I){return I.code===b.OK})}return(0,i.jsxs)($._z,{childrenContentStyle:{padding:20},children:[(0,i.jsx)(z.Z,{children:(0,i.jsxs)(L.t,{submitter:{resetButtonProps:{style:{display:"none"}}},formRef:C,layout:"vertical",span:6,onFinish:function(d){return Y(d)},children:[(0,i.jsx)(j.$,{}),(0,i.jsx)(T.l,{name:"deviceId"}),(0,i.jsx)(x.Z,{name:"range",transform:function(d){var I,G,Z,Q=(I=(0,b.G$)(d))!==null&&I!==void 0?I:[],X=_()(Q,2),k=X[0],J=X[1];return{startTime:k?(G=te()(k))===null||G===void 0?void 0:G.unix():void 0,endTime:J?(Z=te()(J))===null||Z===void 0?void 0:Z.unix():void 0}},placeholder:[V.formatMessage({id:"pages.position-manage.tracking-manage.start.time",defaultMessage:"\u8BF7\u9009\u62E9\u8D77\u59CB\u65F6\u95F4"}),V.formatMessage({id:"pages.position-manage.tracking-manage.end.time",defaultMessage:"\u8BF7\u9009\u62E9\u7ED3\u675F\u65F6\u95F4"})]})]})}),(0,i.jsx)(w.Z,{style:{marginTop:12},children:(0,i.jsx)(B,{map:n==null||(f=n.data)===null||f===void 0?void 0:f.picture,rect:[n==null||(F=n.data)===null||F===void 0?void 0:F.length,n==null||(H=n.data)===null||H===void 0?void 0:H.width],stations:a==null?void 0:a.items,beacons:v==null?void 0:v.data})})]})}},84140:function(ee,W,e){e.d(W,{$h:function(){return D},Ig:function(){return B},TB:function(){return C},Um:function(){return f},WN:function(){return q},Zc:function(){return T},_s:function(){return $},aL:function(){return H},bD:function(){return L},s_:function(){return te},uz:function(){return K},x2:function(){return P}});var g=e(13769),_=e.n(g),A=e(15009),r=e.n(A),S=e(97857),s=e.n(S),R=e(99289),m=e.n(R),l=e(48141),U=["deviceId"],E=["deviceId"],M=["gateway"],w=["gateway"];function D(o,n){return t.apply(this,arguments)}function t(){return t=m()(r()().mark(function o(n,u){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,l.request)("/api/v1/beacon",s()({method:"GET",params:s()({current:"1",size:"10"},n)},u||{})));case 1:case"end":return a.stop()}},o)})),t.apply(this,arguments)}function P(o,n){return i.apply(this,arguments)}function i(){return i=m()(r()().mark(function o(n,u){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,l.request)("/api/v1/beacon",s()({method:"POST",headers:{"Content-Type":"application/json"},data:n},u||{})));case 1:case"end":return a.stop()}},o)})),i.apply(this,arguments)}function B(o,n,u){return j.apply(this,arguments)}function j(){return j=m()(r()().mark(function o(n,u,p){var a,O;return r()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return a=n.deviceId,O=_()(n,U),v.abrupt("return",(0,l.request)("/api/v1/beacon/".concat(a),s()({method:"PUT",headers:{"Content-Type":"application/json"},params:s()({},O),data:u},p||{})));case 2:case"end":return v.stop()}},o)})),j.apply(this,arguments)}function T(o,n){return y.apply(this,arguments)}function y(){return y=m()(r()().mark(function o(n,u){var p,a;return r()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return p=n.deviceId,a=_()(n,E),h.abrupt("return",(0,l.request)("/api/v1/beacon/".concat(p),s()({method:"DELETE",params:s()({},a)},u||{})));case 2:case"end":return h.stop()}},o)})),y.apply(this,arguments)}function K(o,n){return b.apply(this,arguments)}function b(){return b=m()(r()().mark(function o(n,u){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,l.request)("/api/v1/gateway",s()({method:"GET",params:s()({current:"1",size:"10"},n)},u||{})));case 1:case"end":return a.stop()}},o)})),b.apply(this,arguments)}function $(o,n){return z.apply(this,arguments)}function z(){return z=m()(r()().mark(function o(n,u){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,l.request)("/api/v1/gateway",s()({method:"POST",headers:{"Content-Type":"application/json"},data:n},u||{})));case 1:case"end":return a.stop()}},o)})),z.apply(this,arguments)}function L(o,n){return x.apply(this,arguments)}function x(){return x=m()(r()().mark(function o(n,u){var p,a;return r()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return p=n.gateway,a=_()(n,M),h.abrupt("return",(0,l.request)("/api/v1/gateway/".concat(p),s()({method:"DELETE",params:s()({},a)},u||{})));case 2:case"end":return h.stop()}},o)})),x.apply(this,arguments)}function q(o,n,u){return ae.apply(this,arguments)}function ae(){return ae=m()(r()().mark(function o(n,u,p){var a,O;return r()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return a=n.gateway,O=_()(n,w),v.abrupt("return",(0,l.request)("/api/v1/gateway".concat(a),s()({method:"PUT",headers:{"Content-Type":"application/json"},params:s()({},O),data:u},p||{})));case 2:case"end":return v.stop()}},o)})),ae.apply(this,arguments)}function te(o,n){return ne.apply(this,arguments)}function ne(){return ne=m()(r()().mark(function o(n,u){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,l.request)("/api/v1/location",s()({method:"GET",params:s()({},n)},u||{})));case 1:case"end":return a.stop()}},o)})),ne.apply(this,arguments)}function f(o,n){return F.apply(this,arguments)}function F(){return F=m()(r()().mark(function o(n,u){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,l.request)("/api/v1/status/beacon",s()({method:"GET",params:s()({},n)},u||{})));case 1:case"end":return a.stop()}},o)})),F.apply(this,arguments)}function H(o,n){return V.apply(this,arguments)}function V(){return V=m()(r()().mark(function o(n,u){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,l.request)("/api/v1/status/gateway",s()({method:"GET",params:s()({},n)},u||{})));case 1:case"end":return a.stop()}},o)})),V.apply(this,arguments)}function C(o,n){return N.apply(this,arguments)}function N(){return N=m()(r()().mark(function o(n,u){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,l.request)("/api/v1/unbound/beacon",s()({method:"GET",params:s()({},n)},u||{})));case 1:case"end":return a.stop()}},o)})),N.apply(this,arguments)}}}]);
